
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms &#8212; CIMR L2 SIC, SIED, and LIC ATBD</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/styles.css?v=df429b37" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/DD-JNB Sea Ice Concentration Offline Preparation';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Sea Ice Extent and Area computation" href="DD-JNB%20Sea%20Ice%20Extent%20and%20Area.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">This is V2D of the ATBD, prepared for TC#2 (May 2025)</div>
  </div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="CIMR L2 SIC, SIED, and LIC ATBD - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="CIMR L2 SIC, SIED, and LIC ATBD - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    CIMR L2 SIC, SIED, SIC1H, SIED1H and LIC ATBD
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00_abstract.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_applicable_ref_docs.html">Applicable and reference documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_acronyms_and_definitions.html">Acronyms and definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_introduction_purpose_scope.html">Introduction, purpose and scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_background_justification_algorithm.html">Background and justification of selected algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_baseline_algorithm_definition_SIC.html">Baseline Algorithm Definition for SIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_baseline_algorithm_definition_SIED.html">Baseline Algorithm Definition for SIED</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_baseline_algorithm_definition_LIC.html">Baseline Algorithm Definition for LIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_baseline_algorithm_definition_SIE.html">Baseline Algorithm Definition for SIE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_input_output_data_definition_SIC-SIED.html">Algorithm Input and Output Data Definition (IODD) for SIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_input_output_data_definition_LIC.html">Algorithm Input and Output Data Definition (IODD) for LIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../annex.html">Annex</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="DD-JNB%20Sea%20Ice%20Concentration%20Edge%20and%20Lake%20Ice%20Cover%20AMSR2.html">Sea Ice Concentration Algorithm Demonstration on AMSR2 data</a></li>
<li class="toctree-l2"><a class="reference internal" href="DD-JNB%20Sea%20Ice%20Concentration%20and%20Edge%20on%20SCEPS%20Polar%20Scene.html">Sea Ice Concentration Algorithm Demonstration on SCEPS Polar Scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="DD-JNB%20Sea%20Ice%20Concentration%20and%20Edge%20on%20SCEPS%20Polar%20Scene%20Performance%20Assessement.html">Sea Ice Concentration Algorithm Demonstration on SCEPS Polar Scene (Performance Assessment)</a></li>
<li class="toctree-l2"><a class="reference internal" href="DD-JNB%20Sea%20Ice%20Extent%20and%20Area.html">Sea Ice Extent and Area</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Dynamic tuning of the SIC algorithm (OFFLINE chain)</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/CIMR-L2PAD/SeaIceConcentrationEdge_ATBD" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/DD-JNB Sea Ice Concentration Offline Preparation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#locate-di-tds-jnb-and-configuration">Locate DI-TDS-JNB and configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-hybrid-dynamic-fixed-tuning-for-the-sceps-polar-scene-1">An hybrid dynamic / fixed tuning for the SCEPS Polar Scene 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sic-algorithm-tuning-against-l2pp-tbs">SIC algorithm tuning against L2PP TBs.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oza-compensated-tuning">OZA-compensated tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#per-feed-tuning">Per-feed tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sic-tuning-against-static-dataset-esa-cci-rrdp">SIC tuning against static dataset (ESA CCI RRDP)</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="offline-preparations-for-l2-sea-ice-concentration-sic-and-sea-ice-edge-sied-algorithms">
<h1>Offline preparations for L2 Sea Ice Concentration (SIC) and Sea Ice Edge (SIED) algorithms<a class="headerlink" href="#offline-preparations-for-l2-sea-ice-concentration-sic-and-sea-ice-edge-sied-algorithms" title="Link to this heading">#</a></h1>
<p><strong>Authors</strong>: T. Lavergne (METNO)</p>
<p>This notebook implements a series of “offline” preparation steps for the Level-2 SIC3H and SIED3H algorithms for the CIMR mission.</p>
<p>Generally, <em>offline</em> preparations are steps that are run on a regular basis (e.g. every hours, every day, etc…). They aim at preparing everything needed for the L2 algorithms to run efficiently at once a new l2pp file is available. For example, external Auxiliary Data Files (ADFs) can be fetched and pre-processed on an hourly basis by an <em>offline</em> chain, to minimize the waiting time when a new l2pp product arrives.</p>
<p>Specifically, this notebook implements the dynamic tuning of the SIC algorithm against a rolling archive of l2pp files, as is the case in the EUMETSAT OSI SAF and ESA CCI processing chains. In an operational, the rolling archive gives access to typically 5-10 days of L2PP data (full L2PP files or subsets of OZA-compensated TBs and auxiliary fields). In this demonstration prototype, we have to use the only simulated l2pp files we have, which is the SCEPS Polar Scene 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>

<span class="c1"># modules in the L2 Sea Ice Concentration ATBD (v2) contain software code that implement the SIC algorithm</span>
<span class="c1"># &#39;local&#39; software modules to implement the SIC algorithm</span>
<span class="n">_syspath</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">_syspath</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;/algorithm/&#39;</span> <span class="ow">in</span> <span class="n">_syspath</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../algorithm&#39;</span><span class="p">))</span>
        <span class="k">break</span>
<span class="kn">from</span> <span class="nn">sirrdp</span> <span class="kn">import</span> <span class="n">rrdp_file</span>
<span class="kn">from</span> <span class="nn">pmr_sic</span> <span class="kn">import</span> <span class="n">tiepoints</span> <span class="k">as</span> <span class="n">tp</span>
<span class="kn">from</span> <span class="nn">pmr_sic</span> <span class="kn">import</span> <span class="n">hybrid_algo</span>

<span class="c1"># modules to read CIMR l2pp files (for the dynamic tuning against an archive of past l2pp files)</span>
<span class="c1"># &#39;l2ppl2 bridge&#39; software modules to read the l2pp files</span>
<span class="n">_syspath</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">_syspath</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;/L1BL2Bridge_ATBD/&#39;</span> <span class="ow">in</span> <span class="n">_syspath</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../../L1BL2Bridge_ATBD/algorithm&#39;</span><span class="p">))</span>
        <span class="k">break</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">io_handler</span> <span class="k">as</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">collocation</span> <span class="k">as</span> <span class="n">coll</span>

<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># encoder class for writing JSON files</span>
<span class="k">class</span> <span class="nc">MyEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="c1"># https://stackoverflow.com/questions/27050108/convert-numpy-type-to-python/27050186#27050186</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyEncoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="locate-di-tds-jnb-and-configuration">
<h2>Locate DI-TDS-JNB and configuration<a class="headerlink" href="#locate-di-tds-jnb-and-configuration" title="Link to this heading">#</a></h2>
<p>The input data for this notebook are organized under [DI-TDS-JNB] (Test Data Set for Jupyter NoteBook). The default is to access this TDS online through thredds / opendap unless the environment variable <code class="docutils literal notranslate"><span class="pre">CIMR_L2PAD_JNB_TDS</span></code> is set. If it is set, it is the path to a local copy of the TDS.</p>
<p>We access an L2PP file with all the TBs and auxiliary fields added in the l2pp/L2 Bridge, including OZA compensation terms, as well as atmospheric contribution terms tau, Tup, and Tdown (among others).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">tds_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CIMR_L2PAD_JNB_TDS&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use local TDS: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tds_root</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="n">tds_root</span> <span class="o">=</span> <span class="s1">&#39;https://thredds.met.no/thredds/dodsC/cimr/L2PAD/DI-TDS-JNB_draft&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Use online TDS: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tds_root</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Use local TDS: /home/thomasl/Work/L2PAD/local_TDS/
</pre></div>
</div>
</div>
</div>
<div class="cell tag_parameters docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell has a tag &#39;parameters&#39; and is used for the CLI with papermill</span>
<span class="n">l2pp_archive_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tds_root</span><span class="p">,</span><span class="s1">&#39;CIMR_L2PP&#39;</span><span class="p">)</span>
<span class="n">out_dir</span> <span class="o">=</span> <span class="s1">&#39;../data/output/L2SIC_dynamic_tuning/&#39;</span>
<span class="c1">#use_oza_adjust = True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the input parameters</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The output directory </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_dir</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">l2pp_archive_dir</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The L2PP archive directory </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l2pp_archive_dir</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Configure the 3 SIC algorithms we will run as part of the L2 SIC + SIED processors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">algos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;KA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span>  <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">}</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;CKA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb06v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">}</span>
<span class="n">algos</span><span class="p">[</span><span class="s1">&#39;KKA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb19v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">}</span>

<span class="n">tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tb01&#39;</span><span class="p">:</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;tb06&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;tb10&#39;</span><span class="p">:</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;tb19&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">,</span><span class="s1">&#39;tb37&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">,}</span>
<span class="n">rev_tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tb_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">bands_needed</span> <span class="o">+=</span> <span class="n">algos</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_needed</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="an-hybrid-dynamic-fixed-tuning-for-the-sceps-polar-scene-1">
<h2>An hybrid dynamic / fixed tuning for the SCEPS Polar Scene 1<a class="headerlink" href="#an-hybrid-dynamic-fixed-tuning-for-the-sceps-polar-scene-1" title="Link to this heading">#</a></h2>
<p>The SCEPS Polar Scene 1 (v2.1, early 2024) does not reach to high-enough SICs, its peak is around 92%-94% and there are very few values above 95%. This means we cannot extract TB samples for near-100% SIC conditions with lat-lon box. On the other hand, we know the sea-ice emissivity model used by SCEPS for this version of the scene is tuned against the CCI RRDP (AMSR-E and AMSR2).</p>
<p>We thus go for a hybrid approach (dynamic / fixed) for the tuning of our algorithms:</p>
<ul class="simple">
<li><p>The OW TB samples are selected from the CIMR l2pp file, in a lat-lon box over open water conditions.</p></li>
<li><p>The CI TB samples are taken from the CCI RRDP (AMSR-E and AMSR2) (pan-Arctic domain)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># locate and read the RRDP files</span>
<span class="n">rrdp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../data/CCI_SeaIce_RRDP/&#39;</span><span class="p">)</span>
<span class="n">area</span> <span class="o">=</span> <span class="s1">&#39;nh&#39;</span>
<span class="n">ow_files</span><span class="p">,</span> <span class="n">ci_files</span> <span class="o">=</span> <span class="n">rrdp_file</span><span class="o">.</span><span class="n">find_rrdp_files</span><span class="p">(</span><span class="n">rrdp_dir</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="p">(</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2018</span><span class="p">))</span>

<span class="n">channels_needed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">channels_needed</span> <span class="o">+=</span> <span class="n">algos</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
<span class="n">channels_needed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">channels_needed</span><span class="p">)</span>

<span class="n">rrdp_pos</span> <span class="o">=</span> <span class="n">rrdp_file</span><span class="o">.</span><span class="n">read_RRDP_files</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">ow_files</span><span class="p">,</span> <span class="n">ci_files</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels_needed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of OW samples:  15954
Number of CI samples:  13441
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># boxes of lat/lon: (lat_min, lat_max, lon_min, lon_max)</span>
<span class="c1"># To simplify, we use lat/lon boxes here, but in an operational</span>
<span class="c1"># mode the region masks would be defined with more advanced geomasks.</span>
<span class="n">OW_box</span> <span class="o">=</span> <span class="p">(</span><span class="mf">73.</span><span class="p">,</span> <span class="mf">76.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Locate CIMR L2PP files to use in the training. At this stage, we only have 1 realistic swath, so we must use it. But in an operational context the offline training would access a rolling archive of receent L2PP data, typically 5-10 days.</p>
<p>To simplify, we only extract OW and CI samples from one swath file from the archive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">arch_l2pp_fn_patt</span> <span class="o">=</span> <span class="s1">&#39;L2PAD_l2pp_sceps_geo_polar_scene_1_unfiltered_tot_minimal_nom_nedt_apc_tot_v2p1.nc&#39;</span>
<span class="n">arch_l2pp_fn_patt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l2pp_archive_dir</span><span class="p">,</span> <span class="n">arch_l2pp_fn_patt</span><span class="p">)</span>
<span class="n">arch_l2pp_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">arch_l2pp_fn_patt</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arch_l2pp_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING : did not find any good l2pp file in the archive (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arch_l2pp_fn_patt</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Do the training sample extraction and the storing into tie-point objects for each algorithm in turn (<code class="docutils literal notranslate"><span class="pre">CKA</span></code>, <code class="docutils literal notranslate"><span class="pre">KKA</span></code>, and <code class="docutils literal notranslate"><span class="pre">KA</span></code>).</p>
<section id="sic-algorithm-tuning-against-l2pp-tbs">
<h3>SIC algorithm tuning against L2PP TBs.<a class="headerlink" href="#sic-algorithm-tuning-against-l2pp-tbs" title="Link to this heading">#</a></h3>
<p>We perform 2 types of tuning.</p>
<ol class="arabic simple">
<li><p><strong>OZA-compensated tuning</strong>. We tune the <code class="docutils literal notranslate"><span class="pre">CKA</span></code>, <code class="docutils literal notranslate"><span class="pre">KKA</span></code> and <code class="docutils literal notranslate"><span class="pre">KA</span></code> algorithms on L2PP TBs after OZA-compensation. This is the main tuning, to run the NRT3H and NTC SIC algorithms. During the <em>online</em> SIC algorithm, TBs will also be OZA-compensated before entering the algorithms, so we must tune for these TBs here.</p></li>
<li><p><strong>Per-feed tuning</strong>. The <code class="docutils literal notranslate"><span class="pre">KKA</span></code> algorithm is tuned per-feed, without prior OZA-compensation of the TBs. In the <em>online</em> part of the chain, this tuning will be used in the L1B/L2 Bridge to compute the <em>fastL2</em> SICs, before OZA-compensation. See the L1B/L2 Bridge ATBD. The other two algorithms are not tuned per-feed.</p></li>
</ol>
</section>
<section id="oza-compensated-tuning">
<h3>OZA-compensated tuning<a class="headerlink" href="#oza-compensated-tuning" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
<span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;target_band&#39;</span><span class="p">]</span>
    <span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">bands_needed</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">(</span><span class="n">arch_l2pp_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keep_calibration_view</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">selected_bands</span><span class="o">=</span><span class="n">bands_needed</span><span class="p">)</span>

    <span class="c1"># the L2PP files are big and contain many variables we do not need for the offline tuning.</span>
    <span class="c1">#    We drop some variables here.</span>
    <span class="n">aux_vars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;OZA&#39;</span><span class="p">,</span> <span class="s1">&#39;earth_azimuth&#39;</span><span class="p">,</span>
             <span class="s1">&#39;scan_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;horn_scan_angle&#39;</span><span class="p">,)</span>
    <span class="n">l2pp_vars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;orig_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;orig_sample&#39;</span><span class="p">,</span> <span class="s1">&#39;orig_horn&#39;</span><span class="p">,</span><span class="s1">&#39;brightness_temperature_h&#39;</span><span class="p">,</span> <span class="s1">&#39;brightness_temperature_v&#39;</span><span class="p">,</span>
             <span class="s1">&#39;oza_compens_RTM_brightness_temperature_v&#39;</span><span class="p">,</span> <span class="s1">&#39;oza_compens_RTM_brightness_temperature_h&#39;</span><span class="p">,)</span>

    <span class="n">keep_vars</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">aux_vars</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">l2pp_vars</span><span class="p">))</span>

    <span class="n">drop_vars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">bands_needed</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_vars</span><span class="p">:</span>
            <span class="n">drop_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_needed</span><span class="p">:</span>
        <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">drop_vars</span><span class="p">,</span> <span class="p">)</span>
    
    <span class="c1"># apply the (pre-computed) OZA adjustment fields for all bands.</span>
    <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">apply_OZA_adjustment</span><span class="p">()</span>
    
    <span class="c1"># coarsen l2pp samples along the scanlines with a kernel of 5 (horns are *not* combined)</span>
    <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">coarsen_along_scanlines</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># collocate TBs to the target band of the algorithm.</span>
    <span class="k">if</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KA&#39;</span><span class="p">:</span>
        <span class="c1"># we use only one frequency: no need for collocation</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KKA&#39;</span><span class="p">:</span>
        <span class="c1"># the collocation is done along scanlines (to not mix feeds with different OZAs)</span>
        <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">collocate_along_scan</span><span class="p">(</span><span class="n">target_band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;CKA&#39;</span><span class="p">:</span>
        <span class="c1"># the collocation is done across scanlines and mixes feeds with different OZAs</span>
        <span class="c1">#    note : here we also mix forward and aft- scans which is maybe not optimal.</span>
        <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">collocate_channels</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nn&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Collocation step missing for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">))</span>
    
    <span class="c1"># how to access the lat and lon depends on the collocation type</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span>
    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L2PP data type.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the masks for OW samples from the lat-lon box</span>
    <span class="n">_mask</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">_mask</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_lat</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lat</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    
    <span class="c1"># Prepare for extracting the training samples. </span>
    <span class="n">dyn_tbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
    <span class="c1"># Extract the brightness temperatures in the OW areas and store in sample dictionaries</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
        <span class="c1"># for each input channel to the algorithm (e.g. tb19v), deduce the</span>
        <span class="c1">#   name of the variable to be read in the l2pp (or L1C) data structure.</span>
        <span class="n">bn</span> <span class="o">=</span> <span class="n">tb_dict</span><span class="p">[</span><span class="n">ch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
            <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">bn</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bn</span><span class="p">)</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bnstr</span><span class="p">,</span> <span class="n">pol</span><span class="p">)</span>
            <span class="c1"># apply the OW selection mask</span>
            <span class="n">w</span> <span class="o">=</span> <span class="s1">&#39;ow&#39;</span>
            <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
            <span class="c1"># apply the OW selection mask</span>
            <span class="n">w</span> <span class="o">=</span> <span class="s1">&#39;ow&#39;</span>
            <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="n">bn</span><span class="o">+</span><span class="s1">&#39;_BAND&#39;</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L2PP data type.&quot;</span><span class="p">)</span>
            
    <span class="c1">#</span>
    <span class="c1"># OZA-COMPENSATED TUNING, COMBINING ALL FEEDS INTO ONE ALGORITHM</span>
    <span class="c1">#</span>
    
    <span class="c1"># Transfer the training data in a tie-point object. This involves some processing,</span>
    <span class="c1">#  like computing the tie-points and their covariance matrices. </span>
    <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CIMRl2pp-ALLFEEDS&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">dyn_tbs</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
    <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CCI-RRDP&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;CIMR&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OW tie-point for </span><span class="si">{}</span><span class="s2"> ALLFEEDS: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">tp</span><span class="p">))</span>

    <span class="c1"># Tune the SIC algorithm on these tie-points</span>
    <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>

    <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
    <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KA [&#39;KA&#39;]
OW tie-point for KA ALLFEEDS: [139.44649376 210.87917447]
KA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KA_sic_CIMRL2PP-ALLFEEDS.json
CKA [&#39;KA&#39;, &#39;C&#39;]
OW tie-point for CKA ALLFEEDS: [157.31183573 139.4479275  210.87598581]
CKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/CKA_sic_CIMRL2PP-ALLFEEDS.json
KKA [&#39;KA&#39;, &#39;KU&#39;]
INFO: Collocate KA -&gt; KU along scan
OW tie-point for KKA ALLFEEDS: [182.36086616 139.4382549  210.87589254]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-ALLFEEDS.json
</pre></div>
</div>
</div>
</div>
</section>
<section id="per-feed-tuning">
<h3>Per-feed tuning<a class="headerlink" href="#per-feed-tuning" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;KKA&#39;</span><span class="p">,):</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;target_band&#39;</span><span class="p">]</span>
    <span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">bands_needed</span><span class="p">,</span> <span class="p">)</span>

    <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">(</span><span class="n">arch_l2pp_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keep_calibration_view</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">selected_bands</span><span class="o">=</span><span class="n">bands_needed</span><span class="p">)</span>

    <span class="c1"># the L2PP files are big and contain many variables we do not need for the offline tuning.</span>
    <span class="c1">#    We drop some variables here.</span>
    <span class="n">aux_vars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;OZA&#39;</span><span class="p">,</span> <span class="s1">&#39;earth_azimuth&#39;</span><span class="p">,</span>
             <span class="s1">&#39;scan_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;horn_scan_angle&#39;</span><span class="p">,)</span>
    <span class="n">l2pp_vars</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;orig_scan&#39;</span><span class="p">,</span> <span class="s1">&#39;orig_sample&#39;</span><span class="p">,</span> <span class="s1">&#39;orig_horn&#39;</span><span class="p">,</span><span class="s1">&#39;brightness_temperature_h&#39;</span><span class="p">,</span> <span class="s1">&#39;brightness_temperature_v&#39;</span><span class="p">,)</span>

    <span class="n">keep_vars</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">aux_vars</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">l2pp_vars</span><span class="p">))</span>

    <span class="n">drop_vars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">bands_needed</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_vars</span><span class="p">:</span>
            <span class="n">drop_vars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands_needed</span><span class="p">:</span>
        <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">drop_vars</span><span class="p">,</span> <span class="p">)</span>
    
    <span class="c1"># coarsen l2pp samples along the scanlines with a kernel of 5 (horns are *not* combined)</span>
    <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">coarsen_along_scanlines</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># collocate TBs to the target band of the algorithm.</span>
    <span class="k">if</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KA&#39;</span><span class="p">:</span>
        <span class="c1"># we use only one frequency: no need for collocation</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">algo</span> <span class="o">==</span> <span class="s1">&#39;KKA&#39;</span><span class="p">:</span>
        <span class="c1"># the collocation is done along scanlines (to not mix feeds with different OZAs)</span>
        <span class="n">arch_l2pp</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">collocate_along_scan</span><span class="p">(</span><span class="n">target_band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Per-feed tuning not implemented (not possible?) for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">))</span>
    
    <span class="c1"># how to access the lat and lon depends on the collocation type</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lat</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">lon</span>
    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
        <span class="n">_lat</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">_lon</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;geolocation&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L2PP data type.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create the masks for OW samples from the lat-lon box</span>
    <span class="n">_mask</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">_mask</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_lat</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lat</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&gt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">_lon</span> <span class="o">&lt;</span> <span class="n">OW_box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
    
    <span class="c1"># Prepare for extracting the training samples. We also store the feed number (e.g. 0-7 for KU/KA)</span>
    <span class="c1">#   to be able to later train algorithm for specific feeds.</span>
    <span class="n">dyn_tbs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs_feed</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Extract the brightness temperatures in the OW areas and store in sample dictionaries</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
        <span class="c1"># for each input channel to the algorithm (e.g. tb19v), deduce the</span>
        <span class="c1">#   name of the variable to be read in the l2pp (or L1C) data structure.</span>
        <span class="n">bn</span> <span class="o">=</span> <span class="n">tb_dict</span><span class="p">[</span><span class="n">ch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">):</span>
            <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">bn</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">bnstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bn</span><span class="p">)</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bnstr</span><span class="p">,</span> <span class="n">pol</span><span class="p">)</span>
            <span class="c1"># apply the OW selection mask</span>
            <span class="n">w</span> <span class="o">=</span> <span class="s1">&#39;ow&#39;</span>
            <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
            <span class="c1"># keep the feed number information only for the target band</span>
            <span class="k">if</span> <span class="n">bn</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;orig_horn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">arch_l2pp</span><span class="p">[</span><span class="s1">&#39;_type&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;L1C swath&#39;</span><span class="p">:</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="s1">&#39;brightness_temperature_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span>
            <span class="c1"># apply the OW selection mask</span>
            <span class="n">w</span> <span class="o">=</span> <span class="s1">&#39;ow&#39;</span>
            <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="n">bn</span><span class="o">+</span><span class="s1">&#39;_BAND&#39;</span><span class="p">][</span><span class="n">tb_n</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
            <span class="c1"># keep the feed number information only for the target band</span>
            <span class="k">if</span> <span class="n">bn</span> <span class="o">==</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch_l2pp</span><span class="p">[</span><span class="n">bn</span><span class="o">+</span><span class="s1">&#39;_BAND&#39;</span><span class="p">][</span><span class="s1">&#39;orig_horn&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">_mask</span><span class="p">[</span><span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">to_masked_array</span><span class="p">()</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized L2PP data type.&quot;</span><span class="p">)</span>
    
    <span class="c1">#</span>
    <span class="c1"># PER-FEED TUNING, ONE FOR EACH FEED, no OZA compensation</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">n_horns</span><span class="p">[</span><span class="n">b</span><span class="p">]):</span>
        <span class="n">FEEDNB</span> <span class="o">=</span> <span class="s1">&#39;FEED</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feed</span><span class="p">)</span>
        
        <span class="n">dyn_tbs_f</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dyn_tbs_f</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,):</span>
                <span class="n">dyn_tbs_f</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyn_tbs</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="n">ch</span><span class="p">][</span><span class="n">dyn_tbs_feed</span><span class="p">[</span><span class="n">w</span><span class="p">]</span><span class="o">==</span><span class="n">feed</span><span class="p">]</span>
        
        <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CIMRl2pp-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FEEDNB</span><span class="p">),</span> <span class="n">tbs</span><span class="o">=</span><span class="n">dyn_tbs_f</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
        <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CCI-RRDP&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
        <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;CIMR&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OW tie-point for </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">FEEDNB</span><span class="p">,</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">tp</span><span class="p">))</span>
        
        <span class="c1"># Tune the SIC algorithm on these tie-points</span>
        <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>

        <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
        <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KKA [&#39;KA&#39;, &#39;KU&#39;]
INFO: Collocate KA -&gt; KU along scan
OW tie-point for KKA FEED0: [184.08696665 139.26120481 212.3442934 ]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED0.json
OW tie-point for KKA FEED1: [183.56648083 139.32548574 211.90311752]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED1.json
OW tie-point for KKA FEED2: [183.0547305  139.37276532 211.46769661]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED2.json
OW tie-point for KKA FEED3: [182.54003186 139.40239228 211.03559911]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED3.json
OW tie-point for KKA FEED4: [182.04272814 139.48167391 210.60163844]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED4.json
OW tie-point for KKA FEED5: [181.47872952 139.5071235  210.14570276]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED5.json
OW tie-point for KKA FEED6: [180.98259006 139.57072539 209.70125213]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED6.json
OW tie-point for KKA FEED7: [180.5425952  139.63521035 209.28653768]
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CIMRL2PP-FEED7.json
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sic-tuning-against-static-dataset-esa-cci-rrdp">
<h2>SIC tuning against static dataset (ESA CCI RRDP)<a class="headerlink" href="#sic-tuning-against-static-dataset-esa-cci-rrdp" title="Link to this heading">#</a></h2>
<p>At the end, we also run a tuning of each algorithm against the static set of SIC0 and SIC1 data points
from the ESA CCI Round Robin Data Package (AMSR-E + AMSR2 TBs). This would not be used in the operational processing, but is used now to demonstrate the impact of dynamic tuning of the algorithms in the Performance Assessment chapter.</p>
<p>The training data are taken from the ESA CCI Sea Ice Concentration Round Robin Data Package of Pedersen et al. (2019). The relevant data files as well as routines to parse the files are stored in module siddrp/.</p>
<blockquote>
<div><p>Pedersen, Leif Toudal; Saldo, Roberto; Ivanova, Natalia; Kern, Stefan; Heygster, Georg; Tonboe, Rasmus; et al. (2019): Reference dataset for sea ice concentration. figshare. Dataset. <a class="reference external" href="https://doi.org/10.6084/m9.figshare.6626549.v7">https://doi.org/10.6084/m9.figshare.6626549.v7</a></p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run the tuning for each algorithm in turn</span>
<span class="k">for</span> <span class="n">algo</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    
    <span class="c1"># Transfer the training data in a tie-point object. This involves some processing,</span>
    <span class="c1">#  like computing the tie-points and their covariance matrices. </span>
    <span class="n">ow_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">OWTiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CCI-RRDP&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ow&#39;</span><span class="p">])</span>
    <span class="n">ci_tp</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">CICETiepoint</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CCI-RRDP&#39;</span><span class="p">,</span> <span class="n">tbs</span><span class="o">=</span><span class="n">rrdp_pos</span><span class="p">[</span><span class="s1">&#39;ci&#39;</span><span class="p">])</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">instr</span> <span class="o">=</span> <span class="s1">&#39;AMSRs&#39;</span>
    <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">ci_tp</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;CCI-RRDP&#39;</span>
    
    <span class="c1"># Tune the SIC algorithm on these tie-points</span>
    <span class="n">tuned_algo</span> <span class="o">=</span> <span class="n">hybrid_algo</span><span class="o">.</span><span class="n">HybridSICAlgo</span><span class="p">(</span><span class="n">algos</span><span class="p">[</span><span class="n">algo</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">],</span> <span class="n">ow_tp</span><span class="p">,</span> <span class="n">ci_tp</span><span class="p">)</span>
    
    <span class="c1"># Store the algorithm on disk (JSON file) for later re-use</span>
    <span class="n">json_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_sic_</span><span class="si">{}</span><span class="s1">.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ow_tp</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp_out</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tuned_algo</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MyEncoder</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> SIC configuration file is in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">json_fn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KA_sic_CCI-RRDP.json
CKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/CKA_sic_CCI-RRDP.json
KKA SIC configuration file is in ../data/output/L2SIC_dynamic_tuning/KKA_sic_CCI-RRDP.json
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="DD-JNB%20Sea%20Ice%20Extent%20and%20Area.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Sea Ice Extent and Area computation</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#locate-di-tds-jnb-and-configuration">Locate DI-TDS-JNB and configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-hybrid-dynamic-fixed-tuning-for-the-sceps-polar-scene-1">An hybrid dynamic / fixed tuning for the SCEPS Polar Scene 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sic-algorithm-tuning-against-l2pp-tbs">SIC algorithm tuning against L2PP TBs.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oza-compensated-tuning">OZA-compensated tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#per-feed-tuning">Per-feed tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sic-tuning-against-static-dataset-esa-cci-rrdp">SIC tuning against static dataset (ESA CCI RRDP)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Lavergne, Norwegian Meteorological Institute
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
This ATBD was developed in the context of the ESA-funded CIMR L2PAD project (2023-2027) (ESA 4000143081/23/I-NS).
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>